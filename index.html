<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Glow Christmas - AI Vision</title>
    <style>
        :root {
            --gold: #D4AF37;
            --dark-gold: #8B6B23;
            --bg-dark: #0a0a0a;
        }

        body { margin: 0; overflow: hidden; background: var(--bg-dark); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }
        
        /* ç²¾ç¾å¯åŠ¨ç•Œé¢ */
        #start-overlay {
            position: fixed; inset: 0; z-index: 1000;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            padding: 3rem; border-radius: 2rem;
            border: 1px solid rgba(212, 175, 55, 0.2);
            text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .title-main {
            font-size: 3rem; color: var(--gold); margin: 0;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            letter-spacing: 2px; font-weight: 200;
        }

        /* è¿›åº¦æ¡è®¾è®¡ */
        .loader-container { width: 240px; margin: 2rem 0; text-align: left; }
        .loader-label { color: #888; font-size: 12px; margin-bottom: 8px; letter-spacing: 1px; }
        .bar-bg { width: 100%; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; }
        #bar-fill { width: 0%; height: 100%; background: var(--gold); transition: width 0.3s; box-shadow: 0 0 10px var(--gold); }

        /* æ¸å˜æŒ‰é’® */
        #enter-btn {
            background: linear-gradient(135deg, var(--gold), var(--dark-gold));
            color: black; border: none; padding: 12px 45px;
            font-size: 1.1rem; font-weight: bold; border-radius: 30px;
            cursor: pointer; opacity: 0.3; pointer-events: none;
            transition: all 0.3s; transform: translateY(0);
        }
        #enter-btn.active { opacity: 1; pointer-events: auto; }
        #enter-btn.active:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(212, 175, 55, 0.3); }

        /* è§†é¢‘é¢„è§ˆæ¡† */
        #video-container {
            position: absolute; top: 20px; right: 20px; width: 160px; height: 120px;
            border-radius: 12px; overflow: hidden; border: 1.5px solid var(--gold);
            transform: scaleX(-1); background: #000; z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #input_video { width: 100%; height: 100%; object-fit: cover; }

        .hint-box {
            position: absolute; bottom: 30px; left: 30px; color: white;
            background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px;
            border-left: 3px solid var(--gold); font-size: 13px; line-height: 1.8;
            pointer-events: none; z-index: 50;
        }
    </style>
</head>
<body>

    <div id="start-overlay">
        <div class="glass-panel">
            <h1 class="title-main">Christmas 2025</h1>
            <p style="color: #ccc; margin-top: 10px;">AI Gesture Interaction Experience</p>
            
            <div class="loader-container">
                <div class="loader-label" id="loader-status">æ­£åœ¨è½½å…¥è§†è§‰æ¨¡å‹...</div>
                <div class="bar-bg"><div id="bar-fill"></div></div>
            </div>

            <button id="enter-btn">å¼€å¯å¥‡å¦™ä¹‹æ—…</button>
        </div>
    </div>

    <div id="container"></div>
    <div id="video-container"><video id="input_video" playsinline></video></div>
    
    <div class="hint-box">
        ğŸ–ï¸ å±•å¼€æ‰‹æŒï¼šæ•£å¼€é‡‘è‰²æ˜Ÿè¾°<br>
        âœŠ æ¡ç´§æ‹³å¤´ï¼šèšåˆåœ£è¯ä¹‹æ ‘<br>
        âœ¨ å·¦å³ç§»åŠ¨ï¼šæ—‹è½¬è§†è§’
    </div>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
    import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';

    let scene, camera, renderer, composer, particles;
    let isExploded = false;
    const COUNT = 3000;

    // --- åˆå§‹åŒ– Three.js ---
    function initThree() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1, 12);

        renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.getElementById('container').appendChild(renderer.domElement);

        // åæœŸå¤„ç†ï¼šè¾‰å…‰
        const composer_obj = new EffectComposer(renderer);
        composer_obj.addPass(new RenderPass(scene, camera));
        const bloom = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloom.threshold = 0.25; bloom.strength = 1.6;
        composer_obj.addPass(bloom);
        composer = composer_obj;

        createTree();
        window.addEventListener('resize', onResize);
    }

    function createTree() {
        const geo = new THREE.BufferGeometry();
        const pos = new Float32Array(COUNT * 3);
        const targetPos = new Float32Array(COUNT * 3);

        for(let i=0; i<COUNT; i++) {
            const t = i / COUNT;
            const angle = t * Math.PI * 25;
            const radius = (1 - t) * 4;
            // åˆå§‹æ ‘å½¢æ€
            pos[i*3] = Math.cos(angle) * radius;
            pos[i*3+1] = t * 9 - 4.5;
            pos[i*3+2] = Math.sin(angle) * radius;
        }

        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        const mat = new THREE.PointsMaterial({
            size: 0.08, color: 0xD4AF37, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending
        });
        particles = new THREE.Points(geo, mat);
        scene.add(particles);
    }

    function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        composer.setSize(window.innerWidth, window.innerHeight);
    }

    // --- AI ä¸ æ‘„åƒå¤´é€»è¾‘ ---
    async function initAI() {
        updateLoader(40, "æ­£åœ¨è¿æ¥æ‘„åƒå¤´...");
        const videoElement = document.getElementById('input_video');
        
        try {
            // è¯·æ±‚æƒé™
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { width: 640, height: 480 } 
            });
            videoElement.srcObject = stream;
            await videoElement.play();

            updateLoader(70, "åŠ è½½ AI è®¡ç®—æ¨¡å‹...");
            const hands = new window.Hands({
                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
            });

            hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5 });
            hands.onResults(onHandResults);

            const cameraAI = new window.Camera(videoElement, {
                onFrame: async () => { await hands.send({ image: videoElement }); }
            });
            cameraAI.start();

            updateLoader(100, "å‡†å¤‡å°±ç»ª");
            document.getElementById('enter-btn').classList.add('active');
        } catch (err) {
            console.error("Camera Error:", err);
            updateLoader(100, "ç›¸æœºä¸å¯ç”¨ (è¿›å…¥æ¼”ç¤ºæ¨¡å¼)");
            document.getElementById('enter-btn').classList.add('active');
            document.getElementById('enter-btn').innerText = "è¿›å…¥æ¼”ç¤ºæ¨¡å¼";
        }
    }

    function onHandResults(results) {
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            const landmarks = results.multiHandLandmarks[0];
            // é€»è¾‘ï¼šé£ŸæŒ‡å°– y åæ ‡æ˜¾è‘—é«˜äºé£ŸæŒ‡æ ¹éƒ¨ y åæ ‡ï¼ˆæ³¨æ„å±å¹•åæ ‡ y å‘ä¸‹ï¼‰
            isExploded = landmarks[8].y < landmarks[6].y;
            // è§†è§’éšåŠ¨
            particles.rotation.y += (landmarks[0].x - 0.5) * 0.1;
        }
    }

    function updateLoader(percent, text) {
        document.getElementById('bar-fill').style.width = percent + '%';
        document.getElementById('loader-status').innerText = text;
    }

    // --- ä¸»å¾ªç¯ ---
    function animate() {
        requestAnimationFrame(animate);
        const pos = particles.geometry.attributes.position.array;
        
        for(let i=0; i<COUNT; i++) {
            const idx = i * 3;
            if(isExploded) {
                // æ•£å¼€åŠ¨ç”»é€»è¾‘ (ç®€å•çº¿æ€§ä½ç§»)
                pos[idx] += (Math.random() - 0.5) * 0.1;
                pos[idx+1] += (Math.random() - 0.5) * 0.1;
            } else {
                // å›å½’æ ‘çš„é€»è¾‘ï¼ˆå®é™…åº”ç”¨ä¸­å»ºè®®ç”¨ Tween.js åšå¹³æ»‘è¿‡æ¸¡ï¼‰
                const t = i / COUNT;
                const angle = t * Math.PI * 25 + particles.rotation.y;
                const r = (1 - t) * 4;
                const tx = Math.cos(angle) * r;
                const ty = t * 9 - 4.5;
                const tz = Math.sin(angle) * r;
                pos[idx] += (tx - pos[idx]) * 0.05;
                pos[idx+1] += (ty - pos[idx+1]) * 0.05;
                pos[idx+2] += (tz - pos[idx+2]) * 0.05;
            }
        }
        particles.geometry.attributes.position.needsUpdate = true;
        particles.rotation.y += 0.005;
        composer.render();
    }

    // --- å¯åŠ¨æµç¨‹ ---
    const scripts = [
        "https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js",
        "https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
    ];

    let loadedCount = 0;
    scripts.forEach(src => {
        const s = document.createElement('script');
        s.src = src;
        s.onload = () => {
            loadedCount++;
            if(loadedCount === scripts.length) initAI();
        };
        document.head.appendChild(s);
    });

    initThree();
    animate();

    document.getElementById('enter-btn').onclick = () => {
        document.getElementById('start-overlay').style.opacity = '0';
        setTimeout(() => document.getElementById('start-overlay').remove(), 800);
    };
</script>
</body>
</html>
